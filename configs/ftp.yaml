rules:
  - id: "FTP-001"
    name: "Disable Anonymous Login"
    description: "Anonymous users should not be allowed to authenticate."
    command: "grep 'anonymous_enable' /etc/vsftpd.conf"
    expected: "anonymous_enable=NO"
    severity: "HIGH"
    compliance:
      nist: "IA-2"       # Identification and Authentication
      iso: "A.9.1.2"     # Access to networks
      cis: "2.1"

  - id: "FTP-002"
    name: "Restrict Write Access"
    description: "FTP should be Read-Only by default. Write access allows data modification/malware upload."
    command: "grep 'write_enable' /etc/vsftpd.conf"
    expected: "write_enable=NO"
    severity: "MEDIUM"
    compliance:
      nist: "AC-6"       # Least Privilege
      iso: "A.12.3.1"

  - id: "FTP-003"
    name: "Jail Local Users (Chroot)"
    description: "Users must be restricted to their home directories (chroot) to prevent traversing the filesystem."
    command: "grep 'chroot_local_user' /etc/vsftpd.conf"
    expected: "chroot_local_user=YES"
    severity: "HIGH"
    compliance:
      nist: "AC-6"       # Least Privilege
      cis: "2.2"

  - id: "FTP-004"
    name: "Enforce TLS Encryption"
    description: "FTP sends credentials in cleartext. SSL/TLS must be enabled to prevent sniffing."
    command: "grep 'ssl_enable' /etc/vsftpd.conf"
    expected: "ssl_enable=YES"
    severity: "CRITICAL"
    compliance:
      nist: "SC-8"       # Transmission Confidentiality
      iso: "A.10.1.1"    # Cryptographic controls

  - id: "FTP-005"
    name: "Restrict Passive Ports"
    description: "Passive port range must be defined to allow tight firewall rules."
    # Logic: Check if pasv_min_port is set. If yes, echo SET.
    command: "grep -q 'pasv_min_port' /etc/vsftpd.conf && echo 'SET' || echo 'MISSING'"
    expected: "SET"
    severity: "MEDIUM"
    compliance:
      nist: "SC-7"       # Boundary Protection
      cis: "2.3"

  - id: "FTP-006"
    name: "Configure Login Banner"
    description: "A banner must be displayed to warn users of access policies."
    command: "grep -q 'ftpd_banner' /etc/vsftpd.conf && echo 'CONFIGURED' || echo 'MISSING'"
    expected: "CONFIGURED"
    severity: "LOW"
    compliance:
      nist: "AC-8"       # System Use Notification

  - id: "FTP-007"
    name: "Limit Max Clients"
    description: "Limit concurrent connections to prevent DoS attacks."
    # Logic: Check if max_clients is explicitly set
    command: "grep -q 'max_clients' /etc/vsftpd.conf && echo 'LIMITED' || echo 'UNLIMITED'"
    expected: "LIMITED"
    severity: "MEDIUM"
    compliance:
      nist: "SC-5"       # Denial of Service Protection

  - id: "FTP-008"
    name: "Limit Connections Per IP"
    description: "Limit connections from a single IP to prevent brute-force/scanning."
    command: "grep -q 'max_per_ip' /etc/vsftpd.conf && echo 'LIMITED' || echo 'UNLIMITED'"
    expected: "LIMITED"
    severity: "MEDIUM"
    compliance:
      nist: "AC-2"       # Account Management

  - id: "FTP-009"
    name: "Enable Transfer Logging"
    description: "File transfers must be logged for audit trails."
    command: "grep 'xferlog_enable' /etc/vsftpd.conf"
    expected: "xferlog_enable=YES"
    severity: "HIGH"
    compliance:
      nist: "AU-2"       # Event Logging
      iso: "A.12.4.1"    # Event logging

  - id: "FTP-010"
    name: "Secure Umask Setting"
    description: "Ensure uploaded files are not world-writable (umask 022 or 077)."
    command: "grep 'local_umask' /etc/vsftpd.conf"
    expected: "local_umask=022"
    severity: "HIGH"
    compliance:
      nist: "AC-3"       # Access Enforcement